# Target Function Approximation for Stochastic Circuit Minimization (TFASC)

This project implements the efficient method of target function approximation for stochastic circuit minimization. Given an error bound, the program finds a minimized SC circuit with the approximation error over the target function satisfying the error bound.

Related papers:
- [1]: Exploring Target Function Approximation for Stochastic Circuit Minimization (Chen and Qian, 2020)

## Requirements

- OS: 32-bit Linux (since the tool MVSIS used here cannot be run in 64-bit OS currently)
- gcc
- g++
- make
- libreadline
- ctags
- PERL
- EDA logic synthesis tools: [ABC](http://people.eecs.berkeley.edu/~alanmi/abc/), [MVSIS](https://ptolemy.berkeley.edu/projects/embedded/mvsis/) executive files

## Input Format
Content in the "input.txt" file:
```
degree n
precision m
feature vector
```
For example, the content of the input file "bm1.2.txt" for bm1.2 is:
```
4
8
0 254 771 723 215
```
where 4 on the 1st line is for degree n = 4, and 8 on the 2nd line is for the precision parameter m = 8. On the 3rd line is the input feature vector corresponding to the closest Bernstein polynomial approximating the target function. This input file can be directly generated by the Matlab program in [here](https://github.com/SJTU-ECTL/TFASC/tree/master/Bernstein%20polynomial%20approximation%20by%20Matlab).

# Program Organization
```
| readme.md
| Makefile
|----src
|----tool_dir
|----temp_dir
|----obj
|----input_dir
|     |----demo_benchmarks
|     |----user_benchmarks
|----output_dir
|     |----demo_results
|     |     |----bm1.1
|     |     |----bm1.2
|     |     |----(and so on)
|     |----user_results
|     |     |----test1
|     |     |----(and so on)
```
- src: contains all source files
- tool_dir: contains the executive files of ABC and MVSIS together with the mcnc.genlib library for standard cell mapping. It also contains the PERL scripts for parsing the ABC/MVSIS results to obtain the reported literal count, delay, and area of the circuit. 
- temp_dir: contains temporary files generated during the program is running.
- obj: automatically generated by the program.
- input_dir: contains two sub-folders, i.e., "demo_benchmarks" and "user_benchmarks". "demo_benchmarks" contains the input files for all the benchmarks used in our paper [1], while "user_benchmarks" contains the input file(s) provided by the user.
- output_dir: contains two sub-folders, i.e., "demo_results" and "user_results". "demo_results" contains the output files for all the benchmarks used in our paper [1] in each sub-folder such as "bm1.1/", "bm1.2/", etc., while "user_results" contains the sub-folders of the output file(s) corresponding to the input given by the user.
  The output files are:
  - <bm_name>-solution-summary.txt: overall summary of the solutions for <bm_name>.
  - <bm_name>-solution-<num>.pla: .pla file for the solution with number <num>.
  - <bm_name>-solution<num>.v: gate-lvel Verilog file for the solution with number <num>.
  - <bm_name>_opt_sol_featureVec.txt: feature vector for the best solution with minimum area-delay product (ADP) reported by ABC.
  - bestSol_summary_detailed_ABC.txt: summary of the best solution with minimum ADP reported by ABC.
  - bestSol_summary_detailed_ESPRESSO.txt: summary of the best solution with minimum SOP literal count reported by ESPRESSO.

## Compilation
In the project directory, type "make" to generate the executive "main" file. 

## Usage
There are two modes to run the program, i.e., the "demo" and the "user-defined" modes.
- For the "demo" mode:
  - execution command: "./main -demo \<target function ID\> \<test group ID\>".
  - <target function ID>: 1 to 12 for the following target functions
  ```
  target function ID    target function
  1                     sin(x)
  2                     cos(x)
  3                     exp(-x)
  4                     log(x+1)
  5                     sin(Pi*x)/Pi
  6                     tanh(x)
  7                     tanh(4x)
  8                     x^0.45
  9                     exp(-2x)
  10                    1/(1+exp(-x))
  11                    x^2.2
  12                    0.5*cos(Pi*x)+0.5
  ```


